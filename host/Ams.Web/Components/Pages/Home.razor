@page "/"

<PageTitle>AMS Proof Console</PageTitle>

<MudContainer MaxWidth="MaxWidth.False" Class="ams-shell">
    <MudGrid Class="ma-0" Spacing="0">
        <MudItem xs="12" md="3">
            <MudPaper Class="pa-4 ams-drawer" Elevation="0">
                <MudStack Spacing="2">
                    <MudText Typo="Typo.subtitle2" Class="text-medium-emphasis">Workspace</MudText>
                    <MudText Typo="Typo.body2">@WorkspaceDescription</MudText>
                    <MudTextField @bind-Value="_chapterFilter"
                                  Placeholder="Search chapters..."
                                  Adornment="Adornment.Start"
                                  AdornmentIcon="@Icons.Material.Filled.Search"
                                  Immediate="true"
                                  Variant="Variant.Outlined" />
                    @if (_isChaptersLoading)
                    {
                        <MudProgressLinear Indeterminate="true" Color="Color.Primary" Class="mt-2" />
                    }
                    <MudList T="ChapterListItemDto" Dense="true" Class="mt-2">
                        @if (FilteredChapters.Count == 0)
                        {
                            <MudListItem T="ChapterListItemDto" Disabled="true">
                                <MudText Typo="Typo.body2">No chapters</MudText>
                            </MudListItem>
                        }
                        else
                        {
                            @foreach (var chapter in FilteredChapters)
                            {
                                <MudListItem T="ChapterListItemDto"
                                             Class="@GetChapterItemClass(chapter)"
                                             OnClick="@(() => SelectChapterAsync(chapter))">
                                    <MudStack>
                                        <MudText Typo="Typo.body2">@chapter.Name</MudText>
                                        <MudText Typo="Typo.caption" Class="text-medium-emphasis">
                                            @FormatDuration(chapter.DurationSeconds) • @chapter.SentenceCount sentences
                                        </MudText>
                                    </MudStack>
                                </MudListItem>
                            }
                        }
                    </MudList>
                </MudStack>
            </MudPaper>
        </MudItem>
        <MudItem xs="12" md="9">
            <MudPaper Class="pa-4 h-100" Elevation="0">
                @if (_isChapterLoading)
                {
                    <MudStack AlignItems="AlignItems.Center" Justify="Justify.Center" Class="h-100">
                        <MudProgressCircular Indeterminate="true" Size="Size.Large" />
                        <MudText Typo="Typo.subtitle1">Loading chapter…</MudText>
                    </MudStack>
                }
                else if (SelectedChapter is null)
                {
                    <MudStack AlignItems="AlignItems.Center" Justify="Justify.Center" Class="h-100">
                        <MudIcon Icon="@Icons.Material.Filled.LibraryMusic" Size="Size.Large" />
                        <MudText Typo="Typo.h6">Select a chapter to begin</MudText>
                    </MudStack>
                }
                else
                {
                    <MudStack Spacing="2">
                        <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="1">
                            <MudText Typo="Typo.h5">@SelectedChapter.Name</MudText>
                            <MudChip T="string" Color="Color.Secondary" Variant="Variant.Filled">
                                @SelectedChapter.SentenceCount sentences
                            </MudChip>
                            <MudChip T="string" Color="Color.Info" Variant="Variant.Outlined">
                                @FormatDuration(SelectedChapter.DurationSeconds)
                            </MudChip>
                        </MudStack>

                        <audio @ref="_audioRef"
                               class="ams-audio"
                               src="@AudioSource"
                               controls
                               preload="metadata">
                        </audio>

                        <MudPaper Outlined="true">
                            <MudTable Items="SentencesToDisplay"
                                      Hover="true"
                                      Dense="true"
                                      Bordered="false"
                                      Class="full-width">
                                <HeaderContent>
                                    <MudTh>Sentence</MudTh>
                                    <MudTh>Book Text</MudTh>
                                    <MudTh>Start</MudTh>
                                    <MudTh>End</MudTh>
                                </HeaderContent>
                                <RowTemplate>
                                    <MudTr Class="@GetSentenceRowClass(context)"
                                           @onclick="() => OnSentenceSelected(context)">
                                        <MudTd DataLabel="Sentence">
                                            <MudText Typo="Typo.subtitle2">@context.Id</MudText>
                                        </MudTd>
                                        <MudTd DataLabel="Book Text">
                                            <MudText Typo="Typo.body2">@context.BookText</MudText>
                                        </MudTd>
                                        <MudTd DataLabel="Start">
                                            @FormatTime(context.Timing?.Start)
                                        </MudTd>
                                        <MudTd DataLabel="End">
                                            @FormatTime(context.Timing?.End)
                                        </MudTd>
                                    </MudTr>
                                </RowTemplate>
                            </MudTable>
                        </MudPaper>
                    </MudStack>
                }
            </MudPaper>
        </MudItem>
    </MudGrid>
</MudContainer>
