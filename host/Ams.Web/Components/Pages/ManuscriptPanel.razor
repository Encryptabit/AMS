@using Ams.Web.Dtos

@if (Sentences.Count == 0)
{
    <MudStack AlignItems="AlignItems.Center" Justify="Justify.Center" Class="pa-16">
        <MudText Typo="Typo.body1" Color="Color.Secondary">No sentences loaded</MudText>
    </MudStack>
}
else
{
    <MudList T="SentenceDto" Dense="true" Class="pa-0">
        @foreach (var sentence in Sentences.ToList())
        {
            <MudListItem Class="@GetRowClass(sentence)"
                         OnClick="@(() => OnSentenceClick(sentence))">
                <MudStack Row="true" Spacing="2" Class="align-center">
                    <MudText Typo="Typo.caption" Color="Color.Secondary" Class="sentence-id" Style="min-width: 60px; text-align: right;">
                        S@sentence.Id
                    </MudText>

                    <MudStack Spacing="1" Class="flex-grow-1">
                        <MudText Typo="Typo.body1" Class="sentence-text">
                            @sentence.BookText
                        </MudText>
                        @if (!string.IsNullOrEmpty(sentence.ScriptText) && sentence.ScriptText != sentence.BookText)
                        {
                            <MudText Typo="Typo.body2" Color="Color.Warning" Style="font-style: italic;">
                                Script: @sentence.ScriptText
                            </MudText>
                        }
                    </MudStack>

                    <MudStack Row="true" Spacing="1" Style="min-width: 60px;" Justify="Justify.Center">
                        @if (sentence.Diff != null)
                        {
                            @if (sentence.Diff.Stats.Insertions > 0)
                            {
                                <MudIcon Icon="@Icons.Material.Filled.Add" Size="Size.Small" Color="Color.Success" />
                            }
                            @if (sentence.Diff.Stats.Deletions > 0)
                            {
                                <MudIcon Icon="@Icons.Material.Filled.Remove" Size="Size.Small" Color="Color.Error" />
                            }
                        }
                    </MudStack>
                </MudStack>
            </MudListItem>
            <MudDivider />
        }
    </MudList>
}

@code {
    [Parameter] public IReadOnlyList<SentenceDto> Sentences { get; set; } = Array.Empty<SentenceDto>();
    [Parameter] public SentenceDto? SelectedSentence { get; set; }
    [Parameter] public EventCallback<SentenceDto> OnSentenceSelected { get; set; }

    private string GetRowClass(SentenceDto sentence)
    {
        var classes = new List<string> { "manuscript-row" };

        if (sentence == SelectedSentence)
        {
            classes.Add("mud-selected-item");
        }

        if (sentence.Diff != null && (sentence.Diff.Stats.Insertions > 0 || sentence.Diff.Stats.Deletions > 0))
        {
            classes.Add("has-diff");
        }

        return string.Join(" ", classes);
    }

    private async Task OnSentenceClick(SentenceDto sentence)
    {
        await OnSentenceSelected.InvokeAsync(sentence);
    }
}
