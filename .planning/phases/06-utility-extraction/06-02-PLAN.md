---
phase: 06-utility-extraction
plan: 02
type: execute
---

<objective>
Relocate MFA artifacts to proper location and remove unused AudioProcessor methods.

Purpose: Improve code organization by moving MFA models to Application layer and removing ~160 lines of dead code from AudioProcessor.
Output: MFA artifacts in Application/Mfa/Models/, AudioProcessor methods verified unused and removed.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-recommendations/ACTION-LIST.md

**Prior decisions:**
- AUD-014: MFA artifacts in wrong location - RELOCATE to Application/Mfa/Models
- AUD-011: Unused AudioProcessor methods - DELETE
- AUD-025: Commented SnapToEnergyAuto reference - DELETE

**Files to relocate:**
- `host/Ams.Core/Artifacts/Alignment/MfaChapterContext.cs` (17 lines)
- `host/Ams.Core/Artifacts/Alignment/MfaCommandResult.cs` (6 lines)

**Methods to remove from AudioProcessor (verified zero callers):**
- AudioProcessor.cs: AdjustVolume, FadeOut, EncodeWav, NormalizeLoudness
- AudioProcessor.Analysis.cs: AnalyzeGap, FindSpeechEndFromGap, SnapToEnergyAuto
</context>

<tasks>

<task type="auto">
  <name>Task 1: Relocate MFA artifacts to Application/Mfa/Models</name>
  <files>host/Ams.Core/Application/Mfa/Models/MfaChapterContext.cs, host/Ams.Core/Application/Mfa/Models/MfaCommandResult.cs</files>
  <action>
    1. Create directory: `host/Ams.Core/Application/Mfa/Models/`

    2. Move MfaChapterContext.cs:
       - `git mv host/Ams.Core/Artifacts/Alignment/MfaChapterContext.cs host/Ams.Core/Application/Mfa/Models/`
       - Update namespace from `Ams.Core.Artifacts.Alignment` to `Ams.Core.Application.Mfa.Models`

    3. Move MfaCommandResult.cs:
       - `git mv host/Ams.Core/Artifacts/Alignment/MfaCommandResult.cs host/Ams.Core/Application/Mfa/Models/`
       - Update namespace from `Ams.Core.Artifacts.Alignment` to `Ams.Core.Application.Mfa.Models`

    4. Find and update all callers:
       - `grep -r "MfaChapterContext\|MfaCommandResult" host/ --include="*.cs"`
       - Update using statements from `Ams.Core.Artifacts.Alignment` to `Ams.Core.Application.Mfa.Models`

    5. If Artifacts/Alignment/ directory is now empty, remove it
  </action>
  <verify>
    - `dotnet build host/Ams.Core` succeeds
    - Files exist in new location: host/Ams.Core/Application/Mfa/Models/
    - Old location is empty or removed
    - All tests pass
  </verify>
  <done>MFA artifacts relocated to Application/Mfa/Models/ with correct namespaces</done>
</task>

<task type="auto">
  <name>Task 2: Remove unused AudioProcessor methods</name>
  <files>host/Ams.Core/Processors/AudioProcessor.cs, host/Ams.Core/Processors/AudioProcessor.Analysis.cs</files>
  <action>
    1. First verify each method has zero callers (excluding tests and definitions):
       ```
       grep -r "\.AdjustVolume\(" host/ --include="*.cs"
       grep -r "\.FadeOut\(" host/ --include="*.cs"
       grep -r "\.EncodeWav\(" host/ --include="*.cs"
       grep -r "\.NormalizeLoudness\(" host/ --include="*.cs"
       grep -r "\.AnalyzeGap\(" host/ --include="*.cs"
       grep -r "\.FindSpeechEndFromGap\(" host/ --include="*.cs"
       grep -r "\.SnapToEnergyAuto\(" host/ --include="*.cs"
       ```

       IMPORTANT: If any method HAS callers, DO NOT delete it. Skip that method and document why.

    2. From AudioProcessor.cs, remove (if verified unused):
       - `AdjustVolume` method (~15 lines)
       - `FadeOut` method (~15 lines)
       - `EncodeWav` method (~10 lines) - Note: Check if EncodeWavToStream uses it internally
       - `NormalizeLoudness` method (~40 lines)

    3. From AudioProcessor.Analysis.cs, remove (if verified unused):
       - `AnalyzeGap` method (~48 lines)
       - `FindSpeechEndFromGap` method (~35 lines)
       - `SnapToEnergyAuto` method (~31 lines)
       - Remove any commented-out references to these methods

    4. Remove any private helper methods that become orphaned after removal

    5. Remove any using statements that become unused
  </action>
  <verify>
    - `dotnet build host/Ams.Core` succeeds with 0 errors
    - `dotnet test host/Ams.Tests` passes (58/60, 2 pre-existing FFmpeg failures)
    - AudioProcessor.cs file size reduced
    - AudioProcessor.Analysis.cs file size reduced
  </verify>
  <done>
    - ~160 lines of unused code removed from AudioProcessor files
    - All remaining methods are verified as in-use
    - Build and tests pass
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `dotnet build host/Ams.sln` succeeds with 0 errors
- [ ] `dotnet test host/Ams.Tests` passes (58/60, 2 pre-existing FFmpeg failures)
- [ ] MFA artifacts in host/Ams.Core/Application/Mfa/Models/
- [ ] No duplicate MFA artifacts in Artifacts/Alignment/
- [ ] AudioProcessor.cs reduced by ~80 lines
- [ ] AudioProcessor.Analysis.cs reduced by ~115 lines
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- MFA artifacts properly organized under Application layer
- ~195 lines of dead code eliminated from AudioProcessor
- Issues AUD-011, AUD-014, AUD-025 resolved
</success_criteria>

<output>
After completion, create `.planning/phases/06-utility-extraction/06-02-SUMMARY.md`
</output>
