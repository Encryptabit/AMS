---
phase: 04-recommendations
plan: 02
type: execute
---

<objective>
Synthesize all Phase 3 findings and Plan 04-01 deliverables into final architecture recommendations and prioritized action list.

Purpose: Complete the audit initiative by producing the final deliverables that answer "what should we do and in what order?"
Output: Three deliverables - ARCHITECTURE-MAP.md, ACTION-LIST.md, SUCCESS-VERIFICATION.md
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Phase 3 Audit Artifacts:**
@.planning/phases/03-code-audit/CORE-SUBSYSTEMS.md
@.planning/phases/03-code-audit/RESPONSIBILITY-MAP.md
@.planning/phases/03-code-audit/AUDIT-SYNTHESIS.md
@.planning/phases/03-code-audit/ISSUES-CATALOGUE.md

**Plan 04-01 Outputs (required reading):**
@.planning/phases/04-recommendations/PRUNING-PLAN.md
@.planning/phases/04-recommendations/CONSOLIDATION-PLAN.md
@.planning/phases/04-recommendations/REFACTORING-CANDIDATES.md

**Phase 1 Discovery Artifacts:**
@.planning/phases/01-discovery/FILE-INVENTORY.md
@.planning/phases/01-discovery/MODULE-DEPS.md

**Phase 2 Pipeline Artifacts:**
@.planning/phases/02-pipeline-analysis/PIPELINE-FLOW.md

**Prior decisions affecting this phase:**
- Clean 3-layer architecture: Presentation → Application → Infrastructure
- 10 subsystems identified in Ams.Core
- Architecture health: 6.8/10 (FAIR-GOOD)
- 31 issues catalogued across 5 categories
- No critical blockers identified
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ARCHITECTURE-MAP.md</name>
  <files>.planning/phases/04-recommendations/ARCHITECTURE-MAP.md</files>
  <action>
Create the proposed architecture clarity map showing ideal module boundaries.

Structure:
1. Executive Summary
   - Current state: 6.8/10 health, 10 subsystems, clean 3-layer architecture
   - Target state: What "clean" looks like after recommendations applied
   - Key changes: 3-5 bullet points

2. Current Architecture (As-Is)
   - Project-level diagram (from MODULE-DEPS.md)
   - Subsystem diagram (from CORE-SUBSYSTEMS.md)
   - Pain points highlighted (god class, scattered logic, dead code)

3. Proposed Architecture (To-Be)
   - Same diagrams with proposed changes applied
   - AlignmentService split shown
   - Consolidated locations marked
   - Dead code removed

4. Module Boundary Definitions
   For each of the 10 subsystems:
   - Purpose (one sentence)
   - Owns: what files/concerns belong here
   - Does NOT own: what should be elsewhere
   - Dependencies: what it can depend on
   - Dependents: what can depend on it

5. Folder Structure Recommendation
   - Current: Show current Ams.Core structure
   - Proposed: Show ideal structure after reorganization
   - Migration notes for any relocations

6. Architecture Decision Records (ADRs)
   - ADR-001: Keep 3-layer project architecture
   - ADR-002: Split AlignmentService (if recommended)
   - ADR-003: Interface retention strategy
   - Format: Context, Decision, Consequences

7. Health Score Projection
   - Current: 6.8/10
   - After Quick Wins: projected score
   - After Full Recommendations: projected score
  </action>
  <verify>File exists with all 7 sections, includes both As-Is and To-Be diagrams</verify>
  <done>ARCHITECTURE-MAP.md created with clear module boundaries and proposed structure</done>
</task>

<task type="auto">
  <name>Task 2: Create ACTION-LIST.md</name>
  <files>.planning/phases/04-recommendations/ACTION-LIST.md</files>
  <action>
Create the master prioritized action list synthesizing all recommendations.

Structure:
1. Executive Summary
   - Total actions: count
   - Total effort: hours
   - Projected health improvement: X → Y

2. Immediate Actions (Do This Week)
   - Quick Wins from PRUNING-PLAN.md Phase 1
   - Each item: Action, File(s), Command, Time, Issue ID
   - Total time: ~70 minutes
   - Checkbox format for tracking

3. Short-Term Actions (Next 2 Weeks)
   - PRUNING-PLAN.md Phase 2 items
   - High-priority consolidations from CONSOLIDATION-PLAN.md
   - Test fixes (AUD-007, AUD-020)
   - Each item: Action, Effort, Dependencies, Issue ID
   - Total time estimate

4. Medium-Term Actions (Next Month)
   - AlignmentService decomposition (if recommended)
   - Remaining consolidations
   - Interface simplifications
   - Each item with effort and dependencies

5. Long-Term / Deferred Actions
   - Runtime subsystem decomposition
   - Web stack decisions
   - Test coverage expansion
   - Items explicitly marked "not now"

6. Dependency Graph
   - Show which actions depend on others
   - Critical path highlighted
   - Parallel execution opportunities

7. Risk Assessment
   - For each action category: Risk level, Mitigation
   - Rollback strategy for major changes

8. Success Metrics
   - How to measure progress
   - Checkpoints for validation
  </action>
  <verify>File exists, all 31 issues from ISSUES-CATALOGUE.md are addressed (do, defer, or skip), dependency graph present</verify>
  <done>ACTION-LIST.md created with complete prioritized roadmap</done>
</task>

<task type="auto">
  <name>Task 3: Create SUCCESS-VERIFICATION.md</name>
  <files>.planning/phases/04-recommendations/SUCCESS-VERIFICATION.md</files>
  <action>
Verify all PROJECT.md success criteria are addressed by the audit findings.

Structure:
1. Success Criteria Checklist
   From PROJECT.md, verify each criterion:

   - [ ] Complete call graph exists for every file
     * Status: [MET/PARTIAL/NOT MET]
     * Evidence: Phase 1 deliverables (call graphs, FFmpeg docs)
     * Gaps: Any files not covered

   - [ ] Pipeline flow documented with precise step order
     * Status: [MET/PARTIAL/NOT MET]
     * Evidence: PIPELINE-FLOW.md from Phase 2
     * Gaps: Any unclear steps

   - [ ] Every file has clear purpose documented
     * Status: [MET/PARTIAL/NOT MET]
     * Evidence: FILE-INVENTORY.md, CORE-SUBSYSTEMS.md
     * Gaps: Any undocumented files

   - [ ] Dead code identified and catalogued
     * Status: [MET/PARTIAL/NOT MET]
     * Evidence: DEAD-CODE.md, PRUNING-PLAN.md
     * Gaps: Any suspected but unconfirmed dead code

   - [ ] Consolidation opportunities identified
     * Status: [MET/PARTIAL/NOT MET]
     * Evidence: CONSOLIDATION-PLAN.md, REFACTORING-CANDIDATES.md
     * Gaps: Any areas not analyzed

   - [ ] Architecture map shows clean module boundaries
     * Status: [MET/PARTIAL/NOT MET]
     * Evidence: ARCHITECTURE-MAP.md
     * Gaps: Any unclear boundaries

2. Open Questions Resolution
   From PROJECT.md Open Questions section, answer each:
   - What is the exact pipeline step order? → Answer with reference
   - What does Ams.Dsp.Native contain? → Answer with reference
   - Which abstractions are over-engineered? → Answer with reference
   - What code is truly dead? → Answer with reference
   - Where are FFmpeg P/Invoke entry points? → Answer with reference
   - What's in tools/validation-viewer? → Answer with reference

3. Audit Completeness Assessment
   - Phases completed: 4/4
   - Total deliverables: count
   - Total issues catalogued: 31
   - Coverage assessment: percentage of codebase analyzed
   - Confidence level: HIGH/MEDIUM/LOW

4. Recommendations Summary
   - What we recommend doing (brief)
   - What we recommend NOT doing (brief)
   - What needs more investigation (if any)

5. Handoff Notes
   - For the developer executing these recommendations
   - Key gotchas or warnings
   - Suggested execution order
  </action>
  <verify>File exists, all 6 PROJECT.md success criteria addressed, all 6 open questions answered</verify>
  <done>SUCCESS-VERIFICATION.md created confirming audit objectives met</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] ARCHITECTURE-MAP.md exists with As-Is and To-Be diagrams
- [ ] ACTION-LIST.md exists with all 31 issues addressed
- [ ] SUCCESS-VERIFICATION.md exists with all PROJECT.md criteria checked
- [ ] All files cross-reference Phase 3 and Plan 04-01 deliverables
- [ ] No contradictions between deliverables
- [ ] Recommendations are actionable (not vague)
</verification>

<success_criteria>
- All 3 deliverables created with complete structure
- PROJECT.md success criteria verified (all MET or gaps documented)
- All 31 issues have disposition (do/defer/skip)
- Architecture map shows clear before/after
- Action list has realistic effort estimates and dependencies
- Phase 4 complete, audit initiative complete
</success_criteria>

<output>
After completion, create `.planning/phases/04-recommendations/04-02-SUMMARY.md`:

# Phase 4 Plan 2: Architecture & Action Sequencing Summary

**[Substantive one-liner]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created

- `ARCHITECTURE-MAP.md` - Description
- `ACTION-LIST.md` - Description
- `SUCCESS-VERIFICATION.md` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Phase 4 Complete

Phase 4 (Recommendations) is now **COMPLETE**. All 2 plans executed.

## Audit Initiative Complete

The AMS Codebase Audit & Refactoring initiative is now complete:
- Phase 1: Discovery ✓
- Phase 2: Pipeline Analysis ✓
- Phase 3: Code Audit ✓
- Phase 4: Recommendations ✓

## Next Step

Execute recommendations starting with ACTION-LIST.md Immediate Actions.
</output>
