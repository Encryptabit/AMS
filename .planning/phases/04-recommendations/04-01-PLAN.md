---
phase: 04-recommendations
plan: 01
type: execute
---

<objective>
Create actionable pruning and consolidation plans from Phase 3 audit findings.

Purpose: Transform the 31 catalogued issues into concrete, executable action items with exact file paths, commands, and migration steps.
Output: Three deliverables - PRUNING-PLAN.md, CONSOLIDATION-PLAN.md, REFACTORING-CANDIDATES.md
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Phase 3 Audit Artifacts (primary inputs):**
@.planning/phases/03-code-audit/DEAD-CODE.md
@.planning/phases/03-code-audit/ORPHANED-FILES.md
@.planning/phases/03-code-audit/UNUSED-METHODS.md
@.planning/phases/03-code-audit/SCATTERED-LOGIC.md
@.planning/phases/03-code-audit/RESPONSIBILITY-MAP.md
@.planning/phases/03-code-audit/ISSUES-CATALOGUE.md
@.planning/phases/03-code-audit/AUDIT-SYNTHESIS.md

**Prior decisions affecting this phase:**
- Phase 1.1: Use 146 as actual file count (not 277)
- Phase 1.4: Clean 3-layer architecture confirmed (Presentation → Application → Infrastructure)
- Phase 3: 31 issues catalogued with severity and effort estimates
- Phase 3: Architecture health score 6.8/10 (FAIR-GOOD)
- Phase 3: ~650 lines of confirmed dead code ready for removal

**Key constraints:**
- Analysis before action — these are recommendations, not execution
- Pipeline must keep working (ASR → alignment → MFA → merge is core)
- No new dependencies
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PRUNING-PLAN.md</name>
  <files>.planning/phases/04-recommendations/PRUNING-PLAN.md</files>
  <action>
Create prioritized dead code removal plan synthesizing DEAD-CODE.md, ORPHANED-FILES.md, and UNUSED-METHODS.md.

Structure:
1. Executive summary with total lines removable
2. Phase 1: Quick Wins (< 1 hour total, ~90 lines)
   - List each file with exact path
   - Include git rm command for each
   - Group by confidence level
3. Phase 2: Verified Removals (2-4 hours, ~400 lines)
   - DspDemoRunner.cs, SentenceTimelineBuilder.cs
   - Unused AudioProcessor methods (list each with line count)
   - Include verification grep commands to confirm no callers
4. Phase 3: Review Required (needs discussion)
   - MEDIUM confidence items from ORPHANED-FILES.md
   - Items with dependencies noted
5. Summary table: Phase, Items, Lines, Time, Risk
6. Pre-removal checklist (backup, branch, grep verification)

Do NOT include items marked KEEP in the dead code analysis.
Include specific git commands for each removal.
  </action>
  <verify>File exists with all 5 sections, total lines matches ~650 from AUDIT-SYNTHESIS.md</verify>
  <done>PRUNING-PLAN.md created with phased removal approach and exact commands</done>
</task>

<task type="auto">
  <name>Task 2: Create CONSOLIDATION-PLAN.md</name>
  <files>.planning/phases/04-recommendations/CONSOLIDATION-PLAN.md</files>
  <action>
Create consolidation roadmap from SCATTERED-LOGIC.md and RESPONSIBILITY-MAP.md.

Structure:
1. Executive summary of consolidation opportunities
2. High Priority Consolidations (from SCATTERED-LOGIC.md):
   - Section Resolution Duplication → Extract ChapterLabelResolver
     * Source files involved
     * Target location
     * Migration steps (1-2-3)
     * Effort estimate
   - ASR Buffer Preparation Split → Consolidate to AsrAudioPreparer
     * Same structure
3. Medium Priority Relocations:
   - MFA artifacts to Application/Mfa/
   - Validation files consolidation
4. Interface Simplification:
   - List the 4 questionable interfaces (IMfaService, IBookParser, IBookIndexer, IBookCache)
   - For each: current state, recommendation, migration path
   - IAudioService removal (already in pruning plan, cross-reference)
5. Dependency diagram showing before/after for major consolidations
6. Summary table: Item, Current Location, Target, Effort, Priority

Reference specific issue IDs from ISSUES-CATALOGUE.md (AUD-003, AUD-004, AUD-013, etc.)
  </action>
  <verify>File exists, references all 7 scattered patterns from Phase 3, includes migration steps</verify>
  <done>CONSOLIDATION-PLAN.md created with migration paths for all scattered logic</done>
</task>

<task type="auto">
  <name>Task 3: Create REFACTORING-CANDIDATES.md</name>
  <files>.planning/phases/04-recommendations/REFACTORING-CANDIDATES.md</files>
  <action>
Create detailed refactoring design for major candidates identified in Phase 3.

Structure:
1. AlignmentService Decomposition (AUD-003, HIGH priority, 681 lines)
   - Current responsibilities (4 from RESPONSIBILITY-MAP.md):
     * Anchor computation
     * Transcript indexing
     * Transcript hydration
     * Section resolution
   - Proposed split:
     * AnchorComputeService - responsibility, methods to move, dependencies
     * TranscriptIndexService - same
     * TranscriptHydrationService - same
     * ChapterLabelResolver (utility) - same
   - Method inventory from AlignmentService showing destination
   - Interface changes (if any)
   - Test impact assessment
   - Effort: 16-24 hours
   - Risk: MEDIUM (core alignment logic)

2. Runtime Subsystem Decomposition (AUD-030, LOW priority, 28 files)
   - Current structure (from CORE-SUBSYSTEMS.md)
   - Proposed split: Runtime/Core, Runtime/Workspace, Runtime/Artifacts
   - File mapping showing current → proposed location
   - Effort: 40+ hours
   - Risk: HIGH (touches many files)
   - Recommendation: DEFER until AlignmentService is stable

3. Over-Abstraction Removal
   - IAudioService + AudioService (remove entirely - cross-ref PRUNING-PLAN.md)
   - 4 questionable interfaces (from CONSOLIDATION-PLAN.md)
   - Decision matrix: Keep vs Simplify vs Remove

4. Summary: Candidate, Impact, Effort, Risk, Recommendation (Do Now / Defer / Skip)
  </action>
  <verify>File exists, AlignmentService split is fully detailed with method inventory, all 3 sections present</verify>
  <done>REFACTORING-CANDIDATES.md created with detailed decomposition designs</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] PRUNING-PLAN.md exists with phased approach and git commands
- [ ] CONSOLIDATION-PLAN.md exists with migration steps for all scattered logic
- [ ] REFACTORING-CANDIDATES.md exists with AlignmentService decomposition design
- [ ] All files reference specific issue IDs from ISSUES-CATALOGUE.md
- [ ] Total removable lines in PRUNING-PLAN.md matches ~650 from Phase 3
- [ ] No recommendations contradict PROJECT.md constraints
</verification>

<success_criteria>
- All 3 deliverables created with complete structure
- Pruning plan has exact file paths and git commands
- Consolidation plan has migration steps (not just "consolidate X")
- Refactoring candidates have method-level detail for AlignmentService
- All recommendations traceable to Phase 3 issue IDs
</success_criteria>

<output>
After completion, create `.planning/phases/04-recommendations/04-01-SUMMARY.md`:

# Phase 4 Plan 1: Pruning & Consolidation Plans Summary

**[Substantive one-liner]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created

- `PRUNING-PLAN.md` - Description
- `CONSOLIDATION-PLAN.md` - Description
- `REFACTORING-CANDIDATES.md` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 04-02-PLAN.md (Architecture Map & Action Sequencing)
</output>
