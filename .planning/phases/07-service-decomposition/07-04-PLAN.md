---
phase: 07-service-decomposition
plan: 04
type: execute
---

<objective>
Consolidate validation files and document IBook* interface decisions.

Purpose: Move scattered validation files to single location, document interface rationale.
Output: Validation files consolidated in Application/Validation/, IBook* interfaces documented as KEEP.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Prior decisions affecting this phase:**
- AUD-016, AUD-017, AUD-018: IBook* interfaces should be KEPT (DI value confirmed)
- AUD-026: Validation files scattered across 4 locations

**Issues being addressed:**
- AUD-016: IBookParser interface - KEEP (document decision)
- AUD-017: IBookIndexer interface - KEEP (document decision)
- AUD-018: IBookCache interface - KEEP (document decision)
- AUD-026: Validation files scattered - CONSOLIDATE

**Current validation file locations:**
- `Services/ValidationService.cs`
- `Processors/Validation/ValidationReportBuilder.cs`
- `Validation/ValidationModels.cs`
- `Artifacts/Validation/ValidationReportModels.cs`

**Target location:**
- `Application/Validation/ValidationService.cs`
- `Application/Validation/ValidationReportBuilder.cs`
- `Application/Validation/Models/ValidationModels.cs`
- `Application/Validation/Models/ValidationReportModels.cs`

**Relevant source files:**
@host/Ams.Core/Services/ValidationService.cs
@host/Ams.Core/Processors/Validation/ValidationReportBuilder.cs
@host/Ams.Core/Validation/ValidationModels.cs
@host/Ams.Core/Artifacts/Validation/ValidationReportModels.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Consolidate validation files to Application/Validation/</name>
  <files>host/Ams.Core/Application/Validation/*, host/Ams.Core/Services/ValidationService.cs, host/Ams.Core/Processors/Validation/ValidationReportBuilder.cs, host/Ams.Core/Validation/ValidationModels.cs, host/Ams.Core/Artifacts/Validation/ValidationReportModels.cs</files>
  <action>
Relocate all validation files to single location:

1. Create new directories:
- `host/Ams.Core/Application/Validation/`
- `host/Ams.Core/Application/Validation/Models/`

2. Move files with namespace updates:

a) `Services/ValidationService.cs` -> `Application/Validation/ValidationService.cs`
   - Update namespace: `Ams.Core.Services` -> `Ams.Core.Application.Validation`

b) `Processors/Validation/ValidationReportBuilder.cs` -> `Application/Validation/ValidationReportBuilder.cs`
   - Update namespace: `Ams.Core.Processors.Validation` -> `Ams.Core.Application.Validation`

c) `Validation/ValidationModels.cs` -> `Application/Validation/Models/ValidationModels.cs`
   - Update namespace: `Ams.Core.Validation` -> `Ams.Core.Application.Validation.Models`

d) `Artifacts/Validation/ValidationReportModels.cs` -> `Application/Validation/Models/ValidationReportModels.cs`
   - Update namespace: `Ams.Core.Artifacts.Validation` -> `Ams.Core.Application.Validation.Models`

3. Update all using statements in files that reference these:
- Search for old namespaces and update to new ones
- Check: Commands, Services, Tests that use validation types

4. Delete empty old directories if they become empty:
- `Processors/Validation/` (if empty)
- `Validation/` (if empty)
- `Artifacts/Validation/` (if empty)
  </action>
  <verify>
- `dotnet build host/Ams.Core` succeeds
- `dotnet build host/Ams.Cli` succeeds
- `dotnet test host/Ams.Tests` passes
- All validation files now in Application/Validation/
- Old locations deleted
  </verify>
  <done>
- 4 validation files relocated to Application/Validation/
- All namespaces updated
- All using statements updated across codebase
- Build succeeds with no errors
- All 60 tests pass
- AUD-026 RESOLVED
  </done>
</task>

<task type="auto">
  <name>Task 2: Document IBook* interface decisions</name>
  <files>host/Ams.Core/Services/Interfaces/IBookParser.cs, host/Ams.Core/Services/Interfaces/IBookIndexer.cs, host/Ams.Core/Services/Interfaces/IBookCache.cs</files>
  <action>
Document the decision to KEEP IBook* interfaces with XML comments:

1. Add documentation to `IBookParser.cs`:
```csharp
/// <summary>
/// Abstracts book parsing from source format to BookDocument.
/// </summary>
/// <remarks>
/// KEEP DECISION (AUD-016): This interface is DI-registered and enables
/// swapping implementations for different source formats (Markdown, EPUB, etc.)
/// without changing consuming code. Follows established pattern in codebase.
/// </remarks>
public interface IBookParser
```

2. Add documentation to `IBookIndexer.cs`:
```csharp
/// <summary>
/// Abstracts book indexing to create searchable BookIndex from BookDocument.
/// </summary>
/// <remarks>
/// KEEP DECISION (AUD-017): This interface is DI-registered and enables
/// alternative indexing strategies (e.g., different tokenization, phoneme sources).
/// Part of the established Book* service pattern.
/// </remarks>
public interface IBookIndexer
```

3. Add documentation to `IBookCache.cs`:
```csharp
/// <summary>
/// Abstracts book document caching for performance.
/// </summary>
/// <remarks>
/// KEEP DECISION (AUD-018): This interface is DI-registered and enables
/// swapping cache implementations (memory, disk, distributed).
/// Part of the established Book* service pattern.
/// </remarks>
public interface IBookCache
```

This documents the decision for future maintainers and closes AUD-016, AUD-017, AUD-018.
  </action>
  <verify>
- `dotnet build host/Ams.Core` succeeds
- XML documentation added to all three interfaces
- No functional changes (documentation only)
  </verify>
  <done>
- IBookParser documented with KEEP decision rationale
- IBookIndexer documented with KEEP decision rationale
- IBookCache documented with KEEP decision rationale
- Build succeeds
- AUD-016, AUD-017, AUD-018 RESOLVED
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `dotnet build` succeeds for all projects
- [ ] `dotnet test host/Ams.Tests` passes all 60 tests
- [ ] Validation files consolidated in Application/Validation/
- [ ] Old validation file locations deleted
- [ ] IBook* interfaces have XML documentation explaining KEEP decision
</verification>

<success_criteria>
- All validation files in Application/Validation/ with correct namespaces
- No orphaned validation files in old locations
- IBook* interfaces documented with KEEP rationale
- All tests pass
- AUD-016, AUD-017, AUD-018, AUD-026 RESOLVED
</success_criteria>

<output>
After completion, create `.planning/phases/07-service-decomposition/07-04-SUMMARY.md`
</output>
