---
phase: 08.1-skiasharp-vello-comparison
plan: 02
type: execute
---

<objective>
Add waveform rendering and timing to VelloSharp POC, run side-by-side comparison, and decide on renderer.

Purpose: Make data-driven decision on SkiaSharp vs VelloSharp for AMS desktop UI.
Output: Comparison results documented, renderer decision made, STATE.md updated.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Prior phase output:**
@.planning/phases/08.1-skiasharp-vello-comparison/08.1-01-SUMMARY.md

**POCs to compare:**
@poc/SkiaSharpPoc/SkiaSharpPoc.Shell/MainWindow.xaml.cs
@poc/HybridVelloPoc/HybridVelloPoc.Shell/VelloHostController.cs

**Existing VelloSharp waveform renderer (if present):**
@poc/VelloSharpPoc/WaveformRenderer.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add waveform rendering and timing to VelloSharp POC</name>
  <files>poc/HybridVelloPoc/HybridVelloPoc.Shell/WaveformRenderer.cs, poc/HybridVelloPoc/HybridVelloPoc.Shell/AudioLoader.cs, poc/HybridVelloPoc/HybridVelloPoc.Shell/FrameTimer.cs, poc/HybridVelloPoc/HybridVelloPoc.Shell/VelloHostController.cs</files>
  <action>
    Add waveform rendering to HybridVelloPoc matching SkiaSharpPoc implementation.

    1. Copy/adapt AudioLoader.cs from SkiaSharpPoc:
       - Same memory-mapped/streaming approach
       - Same downsampling logic
       - Load poc/audio_sample.wav

    2. Create WaveformRenderer.cs for Vello:
       - Use Vello scene API (not SKCanvas)
       - Draw waveform using Vello primitives (paths, fills)
       - Same view transform logic (offsetX, scaleX)
       - Same color scheme for visual parity

    3. Add FrameTimer.cs:
       - Same implementation as SkiaSharpPoc
       - Track frame times, calculate FPS

    4. Update VelloHostController.cs:
       - Replace test scene rendering with waveform
       - Wire up frame timing around render calls
       - Add timing overlay to scene
       - Ensure pan/zoom input still works

    Goal: Both POCs render the same waveform with same interaction model.
  </action>
  <verify>Run HybridVelloPoc, waveform displays with pan/zoom, FPS counter shows</verify>
  <done>VelloSharp POC renders waveform with timing, matches SkiaSharpPoc capabilities</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Two POCs rendering identical waveform with frame timing</what-built>
  <how-to-verify>
    Run both POCs side-by-side and compare:

    1. Launch SkiaSharpPoc:
       ```
       dotnet run --project poc/SkiaSharpPoc/SkiaSharpPoc.Shell
       ```

    2. Launch HybridVelloPoc:
       ```
       dotnet run --project poc/HybridVelloPoc/HybridVelloPoc.Shell
       ```

    3. Test scenarios (do in both windows):
       a. Initial load - note FPS when static
       b. Slow pan (drag slowly) - note FPS during motion
       c. Fast pan (drag quickly) - note FPS, any stuttering?
       d. Zoom out to full waveform - note FPS, any lag?
       e. Zoom in to sample level - note FPS
       f. Rapid zoom in/out - note smoothness

    4. Record observations:
       - Which feels smoother during pan?
       - Which feels smoother during zoom?
       - Any visual artifacts in either?
       - Any memory issues with large file?

    5. Note FPS numbers for each scenario in both POCs
  </how-to-verify>
  <resume-signal>
    Provide comparison observations, then type one of:
    - "SkiaSharp wins" - SkiaSharp clearly better
    - "VelloSharp wins" - VelloSharp clearly better
    - "Tie" - No significant difference
    - Or describe issues found
  </resume-signal>
</task>

<task type="auto">
  <name>Task 3: Document findings and update project state</name>
  <files>.planning/phases/08.1-skiasharp-vello-comparison/COMPARISON.md, .planning/STATE.md, .planning/ROADMAP.md</files>
  <action>
    Based on checkpoint feedback, document the comparison and update project state.

    1. Create COMPARISON.md with:
       - Test methodology
       - Performance numbers (FPS for each scenario)
       - Qualitative observations (smoothness, artifacts)
       - Code complexity comparison
       - Integration complexity comparison
       - Recommendation with rationale

    2. Update STATE.md:
       - Add decision to Key Decisions table
       - Update Current Position to Phase 9
       - Update Next Action

    3. Update ROADMAP.md:
       - Mark Phase 8.1 complete
       - Add decision outcome to phase description

    Decision criteria (in order of importance):
    1. Performance with large audio files (primary use case)
    2. Code complexity / maintainability
    3. Integration simplicity with WPF shell
    4. Future-proofing (Avalonia 12 direction)
  </action>
  <verify>COMPARISON.md exists with clear recommendation, STATE.md shows Phase 8.1 complete</verify>
  <done>Renderer decision documented and recorded in project state</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Both POCs run and render waveform with timing
- [ ] Side-by-side comparison completed by user
- [ ] COMPARISON.md documents findings and recommendation
- [ ] STATE.md updated with decision
- [ ] ROADMAP.md shows Phase 8.1 complete
</verification>

<success_criteria>
- Clear, data-driven renderer decision made
- Decision documented with rationale
- Project ready to proceed to Phase 9 with chosen renderer
</success_criteria>

<output>
After completion, create `.planning/phases/08.1-skiasharp-vello-comparison/08.1-02-SUMMARY.md`
</output>
