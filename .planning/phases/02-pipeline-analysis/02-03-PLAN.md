---
phase: 02-pipeline-analysis
plan: 03
type: execute
---

<objective>
Clarify the book indexing and ASR response indexing processes, then synthesize all Phase 2 findings into a complete pipeline flow document.

Purpose: Answer the specific question "what is book indexing vs ASR response indexing" and produce the definitive pipeline documentation.
Output: INDEXING.md explaining both indexing processes, PIPELINE-FLOW.md as the complete synthesis.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Previous plan context:**
@.planning/phases/02-pipeline-analysis/02-01-SUMMARY.md
@.planning/phases/02-pipeline-analysis/02-02-SUMMARY.md

**Phase 1 Discovery findings:**
@.planning/phases/01-discovery/CALLGRAPH-INSIGHTS.md

**Key source files for indexing:**
@host/Ams.Core/Services/Alignment/AlignmentService.cs
@host/Ams.Core/Processors/BookIndexer.cs
@host/Ams.Core/Application/Commands/BuildTranscriptIndexCommand.cs

**From PROJECT.md - Open Questions:**
- What is the exact pipeline step order? (this plan answers it)
- Book indexing and ASR response indexing - their exact order and role

**Prior decisions affecting this phase:**
- AlignmentService.BuildTranscriptIndexAsync is most complex algorithm (Phase 1)
- BookIndexer.Process has 15+ callees (high fan-out)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Document book indexing process</name>
  <files>.planning/phases/02-pipeline-analysis/INDEXING.md</files>
  <action>
    Trace BookIndexer and related book processing:
    1. What triggers book indexing (when in pipeline)
    2. What input does it consume (book markdown, sections)
    3. What output does it produce (book index structure)
    4. How is the index used by alignment

    Read BookIndexer.cs and BuildTranscriptIndexCommand.cs.

    Create INDEXING.md with:
    - Book indexing purpose and timing
    - Input/output documentation
    - Index structure explanation
    - How index enables alignment
  </action>
  <verify>INDEXING.md exists with book indexing documentation</verify>
  <done>Book indexing process fully documented with purpose and timing</done>
</task>

<task type="auto">
  <name>Task 2: Document ASR response indexing process</name>
  <files>.planning/phases/02-pipeline-analysis/INDEXING.md</files>
  <action>
    Trace how ASR output is indexed for alignment:
    1. What ASR response structure is consumed
    2. How tokens are indexed for matching
    3. What data structures enable alignment lookup
    4. Relationship between ASR index and book index

    Read AlignmentService.cs and related alignment processors.

    Add to INDEXING.md:
    - ASR response indexing purpose
    - Token indexing mechanism
    - How ASR index relates to book index
    - Data structures used for matching
  </action>
  <verify>ASR response indexing documented in INDEXING.md</verify>
  <done>ASR indexing process documented with relationship to book index</done>
</task>

<task type="auto">
  <name>Task 3: Synthesize complete pipeline flow documentation</name>
  <files>.planning/phases/02-pipeline-analysis/PIPELINE-FLOW.md</files>
  <action>
    Combine all Phase 2 findings into definitive pipeline documentation:
    1. Complete step-by-step pipeline order (from all 3 plans)
    2. Data flow diagram (from Plan 02)
    3. Artifact production timeline
    4. Entry points and orchestration summary (from Plan 01)
    5. Indexing explanation (from this plan)

    Create PIPELINE-FLOW.md as the definitive reference with:
    - Complete pipeline steps (numbered, ordered)
    - Combined Mermaid diagrams
    - Quick reference table
    - Answers to all PROJECT.md open questions about pipeline

    This document should be the single source of truth for pipeline understanding.
  </action>
  <verify>PIPELINE-FLOW.md exists as comprehensive synthesis document</verify>
  <done>Complete pipeline documentation synthesized from all Phase 2 findings</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] INDEXING.md exists with book indexing documentation
- [ ] INDEXING.md includes ASR response indexing
- [ ] PIPELINE-FLOW.md exists as synthesis document
- [ ] All PROJECT.md pipeline questions answered
- [ ] Complete step order documented
- [ ] Phase 2 deliverables complete
</verification>

<success_criteria>
- Book indexing purpose and timing documented
- ASR response indexing documented
- Relationship between both indexing processes clear
- PIPELINE-FLOW.md provides complete pipeline understanding
- All open questions from PROJECT.md about pipeline answered
- Phase 2 complete
</success_criteria>

<output>
After completion, create `.planning/phases/02-pipeline-analysis/02-03-SUMMARY.md`:

# Phase 2 Plan 3: Indexing Clarification Summary

**[Substantive one-liner about indexing and synthesis]**

## Performance
- Duration: X min
- Tasks: 3

## Accomplishments
- [Key findings about indexing]

## Files Created
- INDEXING.md - [size]
- PIPELINE-FLOW.md - [size]

## Key Findings
- [Book indexing purpose]
- [ASR indexing purpose]
- [Pipeline synthesis]

## Phase 2 Complete

Phase 2 Pipeline Analysis complete. Ready for Phase 3 (Code Audit).

## Open Questions Answered
- What is the exact pipeline step order? [Answer]
- What is book indexing vs ASR indexing? [Answer]
</output>
