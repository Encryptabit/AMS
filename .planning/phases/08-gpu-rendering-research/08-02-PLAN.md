# Plan 08-02: Hybrid Window POC

## Objective

Validate that a WPF shell can host an **owned** Winit/Vello window (not child) for GPU-accelerated rendering, solving the wgpu surface creation failures we encountered with child window approaches.

## Context

From 08-01 research:
- VelloSharp + Avalonia/WPF/WinUI: **NO-GO** (surface composition fails with child windows)
- VelloSharp + pure Winit: **WORKS** (standalone window renders perfectly)

The hypothesis: wgpu requires a "real" top-level window. Using an **owned window** relationship instead of WS_CHILD should work.

## Architecture

```
┌─────────────────────────────────────────────┐
│ WPF Shell Window (MainWindow)               │
│ ┌─────────────────────────────────────────┐ │
│ │ Menu Bar                                │ │
│ ├─────────────────────────────────────────┤ │
│ │ Content Area (placeholder/transparent) │ │
│ │   ┌─────────────────────────────────┐   │ │
│ │   │ Vello Owned Window              │   │ │
│ │   │ (borderless, position-synced)   │   │ │
│ │   │                                 │   │ │
│ │   │ GPU-rendered content here       │   │ │
│ │   └─────────────────────────────────┘   │ │
│ ├─────────────────────────────────────────┤ │
│ │ Status Bar                              │ │
│ └─────────────────────────────────────────┘ │
└─────────────────────────────────────────────┘
```

## Tasks

### Task 1: Create WPF Shell Project
**Goal**: Minimal WPF app with menu bar, content placeholder, status bar

- Create `poc/HybridVelloPoc/` solution
- Add WPF project `HybridVelloPoc.Shell`
- MainWindow with Grid layout: Menu (top), ContentHost (center), Status (bottom)
- ContentHost is a Border with known name for position/size tracking

### Task 2: Integrate VelloSharp.WithWinit
**Goal**: Spawn Winit window from WPF, establish owner relationship

- Reference VelloSharp from source (C:\Projects\VelloSharp)
- Create `VelloHostController` class that:
  - Gets WPF window HWND
  - Spawns Winit window (borderless, no decorations)
  - Sets owner relationship via `SetWindowLongPtr(GWL_HWNDPARENT)`
  - Positions Vello window over ContentHost area

### Task 3: Window Synchronization
**Goal**: Keep Vello window positioned over WPF content area

- Hook WPF window events: LocationChanged, SizeChanged, StateChanged
- On move/resize: reposition Vello window to match ContentHost screen coordinates
- Handle minimize/restore (hide/show Vello window)
- Handle WPF window activation (ensure Vello stays on top of shell, below dialogs)

### Task 4: Input Routing & Validation
**Goal**: Verify input works and document any issues

- Test mouse input in Vello window (pan, zoom from WithWinit sample)
- Test keyboard input
- Document focus behavior
- Verify DPI handling on resize/monitor change
- Create SUMMARY.md with findings and GO/NO-GO verdict

## Success Criteria

- [ ] Vello window renders successfully (wgpu surface created)
- [ ] Window stays positioned correctly during move/resize
- [ ] Input (mouse, keyboard) works in Vello area
- [ ] No flicker or visual artifacts during resize
- [ ] Works across multiple monitors with different DPI

## Dependencies

- VelloSharp source at C:\Projects\VelloSharp
- Rust toolchain installed
- .NET 8+ SDK

## Estimated Complexity

Medium - The core technique is straightforward (owned windows), but window synchronization edge cases may require iteration.
