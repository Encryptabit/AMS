---
phase: 08-gpu-rendering-research
plan: 01
type: execute
---

<objective>
Build VelloSharp POC to evaluate GPU rendering for AMS desktop UI.

Purpose: Determine if VelloSharp meets performance and DX requirements for audio visualization
Output: Working POC with performance measurements and go/no-go recommendation
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-gpu-rendering-research/DISCOVERY.md

**Research Findings:**
- VelloSharp v0.5.0-alpha.1 is the most mature option
- Avalonia packages available: VelloSharp.Avalonia.Vello, VelloSharp.Avalonia.Controls
- Claims 100x faster than SkiaSharp in certain workloads
- Uses wgpu backend (DX12/Vulkan/Metal auto-selected)

**Success Metrics:**
- POC renders at 60 FPS minimum
- Waveform-like graphics update smoothly
- No show-stopping integration issues

**Existing Codebase:**
- Dormant Ams.UI.Avalonia exists in archive/ (ignore for POC)
- Create fresh POC project to evaluate VelloSharp cleanly
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create VelloSharp POC project</name>
  <files>poc/VelloSharpPoc/VelloSharpPoc.csproj, poc/VelloSharpPoc/Program.cs, poc/VelloSharpPoc/App.axaml, poc/VelloSharpPoc/App.axaml.cs, poc/VelloSharpPoc/MainWindow.axaml, poc/VelloSharpPoc/MainWindow.axaml.cs</files>
  <action>
    1. Create new directory `poc/VelloSharpPoc/`
    2. Create Avalonia 11.x project (use stable Avalonia - VelloSharp.Avalonia should work)
    3. Add NuGet packages:
       - Avalonia (11.x)
       - Avalonia.Desktop
       - VelloSharp.Avalonia.Vello
       - VelloSharp.Avalonia.Controls
    4. Create minimal App.axaml/App.axaml.cs with standard Avalonia bootstrap
    5. Create MainWindow.axaml with VelloCanvasControl placeholder
    6. Verify project builds with `dotnet build`

    Note: Use .NET 9.0 to match AMS solution. If VelloSharp requires specific Avalonia version, adjust accordingly.
  </action>
  <verify>dotnet build poc/VelloSharpPoc/VelloSharpPoc.csproj succeeds without errors</verify>
  <done>POC project builds and runs showing empty window with VelloCanvasControl</done>
</task>

<task type="auto">
  <name>Task 2: Implement GPU rendering test patterns</name>
  <files>poc/VelloSharpPoc/MainWindow.axaml.cs, poc/VelloSharpPoc/WaveformRenderer.cs</files>
  <action>
    1. Create WaveformRenderer.cs that generates test patterns:
       - Animated sine wave (simulating audio waveform)
       - 1000+ line segments updating at 60Hz
       - Simple fill rectangles (for spectrogram-like display)
    2. Wire VelloCanvasControl to call WaveformRenderer on each frame
    3. Add FPS counter overlay to measure performance
    4. Use CompositionTarget.Rendering or Avalonia's animation system for continuous updates

    Test pattern should stress-test the renderer with workload similar to real audio visualization.
  </action>
  <verify>dotnet run --project poc/VelloSharpPoc shows animated waveform with FPS counter</verify>
  <done>Test patterns render smoothly, FPS counter displays frame rate</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>VelloSharp POC with animated waveform test patterns and FPS counter</what-built>
  <how-to-verify>
    1. Run: `dotnet run --project poc/VelloSharpPoc`
    2. Observe: Animated waveform should render smoothly
    3. Check FPS counter: Should show 60+ FPS
    4. Resize window: Rendering should adapt without jank
    5. Note any visual artifacts or stuttering
  </how-to-verify>
  <resume-signal>Report: "approved" if 60+ FPS with smooth animation, or describe issues observed</resume-signal>
</task>

<task type="auto">
  <name>Task 3: Document findings and recommendation</name>
  <files>.planning/phases/08-gpu-rendering-research/08-01-SUMMARY.md, .planning/phases/08-gpu-rendering-research/FINDINGS.md</files>
  <action>
    Based on POC results, document:
    1. Create FINDINGS.md with:
       - Performance measurements (FPS, GPU usage if observable)
       - Developer experience notes (setup friction, API quality)
       - Issues encountered and workarounds
       - Comparison to expected workload for audio viz
    2. Make go/no-go recommendation:
       - GO: VelloSharp meets requirements, proceed to Phase 9 with it
       - NO-GO: Issues require evaluating ImpellerSharp (add 08-02-PLAN.md)
    3. Create 08-01-SUMMARY.md per template
  </action>
  <verify>FINDINGS.md exists with clear recommendation, SUMMARY.md follows template</verify>
  <done>Research phase documented with actionable recommendation for Phase 9</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] POC project builds without errors
- [ ] Test patterns render at 60+ FPS
- [ ] FINDINGS.md contains performance data and recommendation
- [ ] SUMMARY.md created per template
</verification>

<success_criteria>
- VelloSharp POC demonstrates GPU rendering capability
- Performance is adequate for audio visualization use case
- Clear recommendation documented for Phase 9 direction
- No show-stopping issues discovered (or they are documented for mitigation)
</success_criteria>

<output>
After completion, create `.planning/phases/08-gpu-rendering-research/08-01-SUMMARY.md`:

# Phase 8 Plan 1: VelloSharp POC Summary

**[One-liner: e.g., "VelloSharp POC achieves 120 FPS - recommended for Phase 9"]**

## Accomplishments
- POC project created with VelloSharp.Avalonia integration
- Test patterns implemented (waveform, rectangles)
- Performance measured and documented

## Files Created/Modified
- `poc/VelloSharpPoc/` - Complete POC project
- `.planning/phases/08-gpu-rendering-research/FINDINGS.md` - Research results

## Decisions Made
- [GO/NO-GO recommendation with rationale]

## Issues Encountered
- [Any blockers or workarounds needed]

## Next Step
- If GO: Ready for Phase 9 (Avalonia 12 Foundation with VelloSharp)
- If NO-GO: Create 08-02-PLAN.md to evaluate ImpellerSharp
</output>
