# Phase 9 Plan 3.2: Layout Lockdown

**Objective:** Adopt proper BitUI layout components - BitLayout for app shell, BitGrid for 2D layouts, BitSpacer for spacing.

## Context

**Available BitUI layout components:**
- **BitLayout** - App shell with Header, NavPanel, Main, Footer sections + StickyHeader/StickyFooter
- **BitGrid + BitGridItem** - 12-column responsive grid system
- **BitStack** - Flexbox for 1D layouts (already using)
- **BitSpacer** - Fixed or flexible spacing

**Current issues:**
- Custom CSS flexbox for app shell (should use BitLayout)
- Inline `style="flex: 1;"` for spacers (should use BitSpacer)
- Custom CSS for sticky positioning (BitLayout has StickyHeader built-in)

## Tasks

<task type="auto">
  <name>Replace MainLayout with BitLayout</name>
  <files>host/Ams.Workstation.Server/Components/Layout/MainLayout.razor, MainLayout.razor.css</files>
  <action>
    Replace custom flexbox layout with BitLayout component:
    ```razor
    <BitLayout StickyHeader="true">
        <Header>
            <div class="header-title">AMS Workstation</div>
            <HeaderControls />
        </Header>
        <Main>
            @Body
        </Main>
    </BitLayout>
    ```
    - Remove custom .workstation-layout, .workstation-header, .workstation-body CSS
    - Keep only header-title styling
    - BitLayout handles 100vh, sticky header, scrollable main automatically
  </action>
  <verify>Build succeeds, app shell layout works correctly</verify>
  <done>MainLayout uses BitLayout with StickyHeader</done>
</task>

<task type="auto">
  <name>Update HeaderControls with BitGrid</name>
  <files>host/Ams.Workstation.Server/Components/Layout/HeaderControls.razor, HeaderControls.razor.css</files>
  <action>
    Replace custom flexbox with BitGrid 12-column layout:
    ```razor
    <BitGrid Columns="12" VerticalAlign="BitAlignment.Center" HorizontalSpacing="1rem">
        <BitGridItem ColumnSpan="3">
            <BitStack Horizontal="true" Gap="0.25rem">
                <!-- Nav buttons -->
            </BitStack>
        </BitGridItem>
        <BitGridItem ColumnSpan="3">
            <BitDropdown ... />
        </BitGridItem>
        <BitGridItem ColumnSpan="2">
            <BitSpacer />
        </BitGridItem>
        <BitGridItem ColumnSpan="4">
            <BitStack Horizontal="true" Gap="0.5rem">
                <!-- Directory input + button -->
            </BitStack>
        </BitGridItem>
    </BitGrid>
    ```
    - Remove custom .header-controls, .header-nav, .header-directory CSS
  </action>
  <verify>Build succeeds, header controls layout unchanged visually</verify>
  <done>HeaderControls uses BitGrid + BitGridItem</done>
</task>

<task type="auto">
  <name>Update ChapterReview header with BitSpacer</name>
  <files>host/Ams.Workstation.Server/Components/Pages/Proof/ChapterReview.razor</files>
  <action>
    Replace inline style spacer with BitSpacer:
    ```razor
    <!-- BEFORE -->
    <div style="flex: 1;"></div>

    <!-- AFTER -->
    <BitSpacer />
    ```
    Or use BitStack alignment:
    ```razor
    <BitStack Horizontal="true" HorizontalAlign="BitAlignment.SpaceBetween">
        <!-- Left: back button, title, badge -->
        <BitStack Horizontal="true" Gap="1rem" VerticalAlign="BitAlignment.Center">
            <BitButton ... />
            <BitText ... />
            <BitBadge ... />
        </BitStack>
        <!-- Right: keyboard hints -->
        <BitText ... />
    </BitStack>
    ```
  </action>
  <verify>Build succeeds, header spacing works correctly</verify>
  <done>No inline styles for layout, uses BitSpacer or BitStack alignment</done>
</task>

<task type="auto">
  <name>Establish layout conventions in app.css</name>
  <files>host/Ams.Workstation.Server/wwwroot/app.css</files>
  <action>
    Add documentation comment with layout conventions:
    ```css
    /* ==========================================================================
       Layout Conventions (BitUI)
       ==========================================================================

       App Shell:     BitLayout (Header, Main, Footer, NavPanel)
       2D Layouts:    BitGrid + BitGridItem (12-column system)
       1D Layouts:    BitStack (Horizontal/Vertical flexbox)
       Spacing:       BitSpacer (fixed width or flexible)

       Gap sizes (use with BitStack/BitGrid):
       - 0.25rem (xs)
       - 0.5rem  (sm)
       - 1rem    (md)
       - 1.5rem  (lg)
       - 2rem    (xl)

       DO NOT USE:
       - Custom flexbox CSS for layout (use BitStack/BitGrid)
       - Inline style="flex: 1" (use BitSpacer)
       - Custom CSS for sticky headers (use BitLayout StickyHeader)
       ========================================================================== */
    ```
  </action>
  <verify>Comment added to app.css</verify>
  <done>Layout conventions documented</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>BitLayout for app shell, BitGrid for header, BitSpacer/alignment for spacing</what-built>
  <how-to-verify>
    1. Run: dotnet run --project host/Ams.Workstation.Server
    2. Verify app shell: Header sticky at top, main content scrolls
    3. Verify header controls: Nav buttons | Dropdown | Spacer | Directory input
    4. Navigate to /proof/TestChapter
    5. Verify: Back button and title left, keyboard hints right
    6. Resize browser - layout should be responsive
    7. Inspect elements - no inline style="flex: 1"
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

## Success Criteria

- [ ] MainLayout uses BitLayout with StickyHeader
- [ ] HeaderControls uses BitGrid + BitGridItem
- [ ] No inline `style="flex: 1;"` anywhere
- [ ] Custom flexbox CSS removed from layout components
- [ ] Layout conventions documented
- [ ] Build succeeds, visual appearance unchanged

## Output

Create `09-03.2-SUMMARY.md` documenting:
- BitLayout adoption for app shell
- BitGrid adoption for header
- CSS removed

## Commit

```
feat(09-03.2): BitLayout + BitGrid layout lockdown

- MainLayout: BitLayout with StickyHeader replaces custom flexbox
- HeaderControls: BitGrid 12-column layout
- ChapterReview: BitSpacer replaces inline flex:1 hack
- Documented layout conventions in app.css
```
